{"links": {"self": {"href": "data/repositories/osrf/drcsim/issues/163/comments/3540428.json"}, "html": {"href": "#!/osrf/drcsim/issues/163#comment-3540428"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/drcsim/issues/163.json"}}, "type": "issue", "id": 163, "repository": {"links": {"self": {"href": "data/repositories/osrf/drcsim.json"}, "html": {"href": "#!/osrf/drcsim"}, "avatar": {"href": "data/bytebucket.org/ravatar/{247b5408-ae91-4e3c-b2f9-a21994658d11}ts=c_plus_plus"}}, "type": "repository", "name": "drcsim", "full_name": "osrf/drcsim", "uuid": "{247b5408-ae91-4e3c-b2f9-a21994658d11}"}, "title": "ros camera plugin not publishing camera_info topic"}, "content": {"raw": "The patch is as follows:\n\n\n```\n#!c++\n\n# HG changeset patch\n# User Jordi Pages <jordi.pages@pal-robotics.com>\n# Date 1364398873 -3600\n# Node ID 5bf4aea711dc05946cbb676298c08ba68894ebe5\n# Parent  52dc606bc3b12a46bb83c2e91d4c380be0607642\nFix broken publishing of camera_info topic.\n\ndiff --git a/ros/atlas_msgs/gazebo_ros_camera.cpp b/ros/atlas_msgs/gazebo_ros_camera.cpp\n--- a/ros/atlas_msgs/gazebo_ros_camera.cpp\n+++ b/ros/atlas_msgs/gazebo_ros_camera.cpp\n@@ -70,14 +70,15 @@ void GazeboRosCamera::OnNewFrame(const u\n   else\n   {\n     if (this->image_connect_count_ > 0)\n     {\n       common::Time cur_time = this->world_->GetSimTime();\n       if (cur_time - this->last_update_time_ >= this->update_period_)\n       {\n         this->PutCameraData(_image);\n+        this->PublishCameraInfo();\n         this->last_update_time_ = cur_time;\n       }\n     }\n   }\n }\n }\n```", "markup": "markdown", "html": "<p>The patch is as follows:</p>\n<div class=\"codehilite language-c++\"><pre><span></span><span class=\"cp\"># HG changeset patch</span>\n<span class=\"cp\"># User Jordi Pages &lt;jordi.pages@pal-robotics.com&gt;</span>\n<span class=\"cp\"># Date 1364398873 -3600</span>\n<span class=\"cp\"># Node ID 5bf4aea711dc05946cbb676298c08ba68894ebe5</span>\n<span class=\"cp\"># Parent  52dc606bc3b12a46bb83c2e91d4c380be0607642</span>\n<span class=\"n\">Fix</span> <span class=\"n\">broken</span> <span class=\"n\">publishing</span> <span class=\"n\">of</span> <span class=\"n\">camera_info</span> <span class=\"n\">topic</span><span class=\"p\">.</span>\n\n<span class=\"n\">diff</span> <span class=\"o\">--</span><span class=\"n\">git</span> <span class=\"n\">a</span><span class=\"o\">/</span><span class=\"n\">ros</span><span class=\"o\">/</span><span class=\"n\">atlas_msgs</span><span class=\"o\">/</span><span class=\"n\">gazebo_ros_camera</span><span class=\"p\">.</span><span class=\"n\">cpp</span> <span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">ros</span><span class=\"o\">/</span><span class=\"n\">atlas_msgs</span><span class=\"o\">/</span><span class=\"n\">gazebo_ros_camera</span><span class=\"p\">.</span><span class=\"n\">cpp</span>\n<span class=\"o\">---</span> <span class=\"n\">a</span><span class=\"o\">/</span><span class=\"n\">ros</span><span class=\"o\">/</span><span class=\"n\">atlas_msgs</span><span class=\"o\">/</span><span class=\"n\">gazebo_ros_camera</span><span class=\"p\">.</span><span class=\"n\">cpp</span>\n<span class=\"o\">+++</span> <span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">ros</span><span class=\"o\">/</span><span class=\"n\">atlas_msgs</span><span class=\"o\">/</span><span class=\"n\">gazebo_ros_camera</span><span class=\"p\">.</span><span class=\"n\">cpp</span>\n<span class=\"err\">@@</span> <span class=\"o\">-</span><span class=\"mi\">70</span><span class=\"p\">,</span><span class=\"mi\">14</span> <span class=\"o\">+</span><span class=\"mi\">70</span><span class=\"p\">,</span><span class=\"mi\">15</span> <span class=\"err\">@@</span> <span class=\"kt\">void</span> <span class=\"n\">GazeboRosCamera</span><span class=\"o\">::</span><span class=\"n\">OnNewFrame</span><span class=\"p\">(</span><span class=\"k\">const</span> <span class=\"n\">u</span>\n   <span class=\"k\">else</span>\n   <span class=\"p\">{</span>\n     <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">image_connect_count_</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">)</span>\n     <span class=\"p\">{</span>\n       <span class=\"n\">common</span><span class=\"o\">::</span><span class=\"n\">Time</span> <span class=\"n\">cur_time</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">world_</span><span class=\"o\">-&gt;</span><span class=\"n\">GetSimTime</span><span class=\"p\">();</span>\n       <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">cur_time</span> <span class=\"o\">-</span> <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">last_update_time_</span> <span class=\"o\">&gt;=</span> <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">update_period_</span><span class=\"p\">)</span>\n       <span class=\"p\">{</span>\n         <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">PutCameraData</span><span class=\"p\">(</span><span class=\"n\">_image</span><span class=\"p\">);</span>\n<span class=\"o\">+</span>        <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">PublishCameraInfo</span><span class=\"p\">();</span>\n         <span class=\"k\">this</span><span class=\"o\">-&gt;</span><span class=\"n\">last_update_time_</span> <span class=\"o\">=</span> <span class=\"n\">cur_time</span><span class=\"p\">;</span>\n       <span class=\"p\">}</span>\n     <span class=\"p\">}</span>\n   <span class=\"p\">}</span>\n <span class=\"p\">}</span>\n <span class=\"p\">}</span>\n</pre></div>", "type": "rendered"}, "created_on": "2013-03-27T16:03:35.234971+00:00", "user": {"display_name": "Jordi Pages", "uuid": "{f31dc481-641a-4ab4-86ab-c114a6ce6bd9}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bf31dc481-641a-4ab4-86ab-c114a6ce6bd9%7D"}, "html": {"href": "https://bitbucket.org/%7Bf31dc481-641a-4ab4-86ab-c114a6ce6bd9%7D/"}, "avatar": {"href": "https://bitbucket.org/account/jpages/avatar/"}}, "nickname": "jpages", "type": "user", "account_id": null}, "updated_on": null, "type": "issue_comment", "id": 3540428}