{"links": {"self": {"href": "data/repositories/osrf/drcsim/issues/457/comments/14792090.json"}, "html": {"href": "#!/osrf/drcsim/issues/457#comment-14792090"}}, "issue": {"links": {"self": {"href": "data/repositories/osrf/drcsim/issues/457.json"}}, "type": "issue", "id": 457, "repository": {"links": {"self": {"href": "data/repositories/osrf/drcsim.json"}, "html": {"href": "#!/osrf/drcsim"}, "avatar": {"href": "data/bytebucket.org/ravatar/{247b5408-ae91-4e3c-b2f9-a21994658d11}ts=c_plus_plus"}}, "type": "repository", "name": "drcsim", "full_name": "osrf/drcsim", "uuid": "{247b5408-ae91-4e3c-b2f9-a21994658d11}"}, "title": "Atlas falls when stepping with libAtlasSimInterface3.so.3.0.0"}, "content": {"raw": "I hacked the keyboard teleop\n\n\n```\n#!c++\n\ndiff -r cc172e49f983 drcsim_gazebo/scripts/keyboard_teleop.py\n--- a/drcsim_gazebo/scripts/keyboard_teleop.py\tTue Jan 13 09:06:25 2015 -0800\n+++ b/drcsim_gazebo/scripts/keyboard_teleop.py\tTue Jan 13 12:50:50 2015 -0800\n@@ -63,6 +63,8 @@\n               \"Swing Height\":{\"value\":0.1, \"min\":0, \"max\":1, \"type\":\"float\"}}\n \n     def init(self):\n+        self.static_count = 0\n+\n         # Saves terminal settings\n         self.settings = termios.tcgetattr(sys.stdin)\n \n@@ -174,21 +176,24 @@\n         self.is_static = True\n         steps = self.build_steps(forward, lateral, turn)\n \n+        idx = self.static_count % 2\n+\n         # step needs index to be 1\n-        steps[0].step_index = 1\n-        steps[0].swing_height = 0.05\n+        steps[idx].step_index = 1\n+        steps[idx].swing_height = 0.05\n \n         # 0 for full BDI control, 255 for PID control\n         k_effort =  [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \\\n           0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\n \n         stand_goal = WalkDemoGoal(Header(), WalkDemoGoal.STEP, None, \\\n-              AtlasBehaviorStepParams(steps[0], False), AtlasBehaviorStandParams(), \\\n+              AtlasBehaviorStepParams(steps[idx], False), AtlasBehaviorStandParams(), \\\n               AtlasBehaviorManipulateParams(),  k_effort )\n \n         self.client.send_goal(stand_goal)\n         # self.client.wait_for_result()\n \n+        self.static_count = self.static_count + 1\n         rospy.sleep(0.3)\n         # for step in steps:\n         #     step.step_index = 1\n\n```\n\nI'm trying out your example code now.", "markup": "markdown", "html": "<p>I hacked the keyboard teleop</p>\n<div class=\"codehilite language-c++\"><pre><span></span><span class=\"n\">diff</span> <span class=\"o\">-</span><span class=\"n\">r</span> <span class=\"n\">cc172e49f983</span> <span class=\"n\">drcsim_gazebo</span><span class=\"o\">/</span><span class=\"n\">scripts</span><span class=\"o\">/</span><span class=\"n\">keyboard_teleop</span><span class=\"p\">.</span><span class=\"n\">py</span>\n<span class=\"o\">---</span> <span class=\"n\">a</span><span class=\"o\">/</span><span class=\"n\">drcsim_gazebo</span><span class=\"o\">/</span><span class=\"n\">scripts</span><span class=\"o\">/</span><span class=\"n\">keyboard_teleop</span><span class=\"p\">.</span><span class=\"n\">py</span>  <span class=\"n\">Tue</span> <span class=\"n\">Jan</span> <span class=\"mi\">13</span> <span class=\"mi\">09</span><span class=\"o\">:</span><span class=\"mo\">06</span><span class=\"o\">:</span><span class=\"mi\">25</span> <span class=\"mi\">2015</span> <span class=\"o\">-</span><span class=\"mi\">0800</span>\n<span class=\"o\">+++</span> <span class=\"n\">b</span><span class=\"o\">/</span><span class=\"n\">drcsim_gazebo</span><span class=\"o\">/</span><span class=\"n\">scripts</span><span class=\"o\">/</span><span class=\"n\">keyboard_teleop</span><span class=\"p\">.</span><span class=\"n\">py</span>  <span class=\"n\">Tue</span> <span class=\"n\">Jan</span> <span class=\"mi\">13</span> <span class=\"mi\">12</span><span class=\"o\">:</span><span class=\"mi\">50</span><span class=\"o\">:</span><span class=\"mi\">50</span> <span class=\"mi\">2015</span> <span class=\"o\">-</span><span class=\"mi\">0800</span>\n<span class=\"err\">@@</span> <span class=\"o\">-</span><span class=\"mi\">63</span><span class=\"p\">,</span><span class=\"mi\">6</span> <span class=\"o\">+</span><span class=\"mi\">63</span><span class=\"p\">,</span><span class=\"mi\">8</span> <span class=\"err\">@@</span>\n               <span class=\"s\">&quot;Swing Height&quot;</span><span class=\"o\">:</span><span class=\"p\">{</span><span class=\"s\">&quot;value&quot;</span><span class=\"o\">:</span><span class=\"mf\">0.1</span><span class=\"p\">,</span> <span class=\"s\">&quot;min&quot;</span><span class=\"o\">:</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"s\">&quot;max&quot;</span><span class=\"o\">:</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"s\">&quot;type&quot;</span><span class=\"o\">:</span><span class=\"s\">&quot;float&quot;</span><span class=\"p\">}}</span>\n\n     <span class=\"n\">def</span> <span class=\"n\">init</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"p\">)</span><span class=\"o\">:</span>\n<span class=\"o\">+</span>        <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">static_count</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n<span class=\"o\">+</span>\n         <span class=\"cp\"># Saves terminal settings</span>\n         <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">settings</span> <span class=\"o\">=</span> <span class=\"n\">termios</span><span class=\"p\">.</span><span class=\"n\">tcgetattr</span><span class=\"p\">(</span><span class=\"n\">sys</span><span class=\"p\">.</span><span class=\"n\">stdin</span><span class=\"p\">)</span>\n\n<span class=\"err\">@@</span> <span class=\"o\">-</span><span class=\"mi\">174</span><span class=\"p\">,</span><span class=\"mi\">21</span> <span class=\"o\">+</span><span class=\"mi\">176</span><span class=\"p\">,</span><span class=\"mi\">24</span> <span class=\"err\">@@</span>\n         <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">is_static</span> <span class=\"o\">=</span> <span class=\"n\">True</span>\n         <span class=\"n\">steps</span> <span class=\"o\">=</span> <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">build_steps</span><span class=\"p\">(</span><span class=\"n\">forward</span><span class=\"p\">,</span> <span class=\"n\">lateral</span><span class=\"p\">,</span> <span class=\"n\">turn</span><span class=\"p\">)</span>\n\n<span class=\"o\">+</span>        <span class=\"n\">idx</span> <span class=\"o\">=</span> <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">static_count</span> <span class=\"o\">%</span> <span class=\"mi\">2</span>\n<span class=\"o\">+</span>\n         <span class=\"cp\"># step needs index to be 1</span>\n<span class=\"o\">-</span>        <span class=\"n\">steps</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"n\">step_index</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>\n<span class=\"o\">-</span>        <span class=\"n\">steps</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">].</span><span class=\"n\">swing_height</span> <span class=\"o\">=</span> <span class=\"mf\">0.05</span>\n<span class=\"o\">+</span>        <span class=\"n\">steps</span><span class=\"p\">[</span><span class=\"n\">idx</span><span class=\"p\">].</span><span class=\"n\">step_index</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>\n<span class=\"o\">+</span>        <span class=\"n\">steps</span><span class=\"p\">[</span><span class=\"n\">idx</span><span class=\"p\">].</span><span class=\"n\">swing_height</span> <span class=\"o\">=</span> <span class=\"mf\">0.05</span>\n\n         <span class=\"cp\"># 0 for full BDI control, 255 for PID control</span>\n         <span class=\"n\">k_effort</span> <span class=\"o\">=</span>  <span class=\"p\">[</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> \\\n           <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">]</span>\n\n         <span class=\"n\">stand_goal</span> <span class=\"o\">=</span> <span class=\"n\">WalkDemoGoal</span><span class=\"p\">(</span><span class=\"n\">Header</span><span class=\"p\">(),</span> <span class=\"n\">WalkDemoGoal</span><span class=\"p\">.</span><span class=\"n\">STEP</span><span class=\"p\">,</span> <span class=\"n\">None</span><span class=\"p\">,</span> \\\n<span class=\"o\">-</span>              <span class=\"n\">AtlasBehaviorStepParams</span><span class=\"p\">(</span><span class=\"n\">steps</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">],</span> <span class=\"n\">False</span><span class=\"p\">),</span> <span class=\"n\">AtlasBehaviorStandParams</span><span class=\"p\">(),</span> \\\n<span class=\"o\">+</span>              <span class=\"n\">AtlasBehaviorStepParams</span><span class=\"p\">(</span><span class=\"n\">steps</span><span class=\"p\">[</span><span class=\"n\">idx</span><span class=\"p\">],</span> <span class=\"n\">False</span><span class=\"p\">),</span> <span class=\"n\">AtlasBehaviorStandParams</span><span class=\"p\">(),</span> \\\n               <span class=\"n\">AtlasBehaviorManipulateParams</span><span class=\"p\">(),</span>  <span class=\"n\">k_effort</span> <span class=\"p\">)</span>\n\n         <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">client</span><span class=\"p\">.</span><span class=\"n\">send_goal</span><span class=\"p\">(</span><span class=\"n\">stand_goal</span><span class=\"p\">)</span>\n         <span class=\"cp\"># self.client.wait_for_result()</span>\n\n<span class=\"o\">+</span>        <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">static_count</span> <span class=\"o\">=</span> <span class=\"n\">self</span><span class=\"p\">.</span><span class=\"n\">static_count</span> <span class=\"o\">+</span> <span class=\"mi\">1</span>\n         <span class=\"n\">rospy</span><span class=\"p\">.</span><span class=\"n\">sleep</span><span class=\"p\">(</span><span class=\"mf\">0.3</span><span class=\"p\">)</span>\n         <span class=\"cp\"># for step in steps:</span>\n         <span class=\"cp\">#     step.step_index = 1</span>\n</pre></div>\n\n\n<p>I'm trying out your example code now.</p>", "type": "rendered"}, "created_on": "2015-01-13T20:51:52.958231+00:00", "user": {"display_name": "Nate Koenig", "uuid": "{c862cdd9-fcc8-4419-9fc7-e20db14b8fcb}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D"}, "html": {"href": "https://bitbucket.org/%7Bc862cdd9-fcc8-4419-9fc7-e20db14b8fcb%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:095b1e12-74ed-4e20-b44f-2f0745b616e0/ca24bb11-4787-4b14-a20d-d91835e9bde2/128"}}, "nickname": "Nathan Koenig", "type": "user", "account_id": "557058:095b1e12-74ed-4e20-b44f-2f0745b616e0"}, "updated_on": null, "type": "issue_comment", "id": 14792090}