{"priority": "blocker", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/drcsim.json"}, "html": {"href": "#!/osrf/drcsim"}, "avatar": {"href": "data/bytebucket.org/ravatar/{247b5408-ae91-4e3c-b2f9-a21994658d11}ts=c_plus_plus"}}, "type": "repository", "name": "drcsim", "full_name": "osrf/drcsim", "uuid": "{247b5408-ae91-4e3c-b2f9-a21994658d11}"}, "links": {"attachments": {"href": "data/repositories/osrf/drcsim/issues/308/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/drcsim/issues/308.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/drcsim/issues/308/watch"}, "comments": {"href": "data/repositories/osrf/drcsim/issues/308/comments_page=1.json"}, "html": {"href": "#!/osrf/drcsim/issues/308/inertia-calculation-for-fixed-joints"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/drcsim/issues/308/vote"}}, "reporter": {"display_name": "Michael Posa", "uuid": "{a3be13e3-ee62-4673-97e4-b14147cc6fa1}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Ba3be13e3-ee62-4673-97e4-b14147cc6fa1%7D"}, "html": {"href": "https://bitbucket.org/%7Ba3be13e3-ee62-4673-97e4-b14147cc6fa1%7D/"}, "avatar": {"href": "https://bitbucket.org/account/mposa/avatar/"}}, "nickname": "mposa", "type": "user", "account_id": null}, "title": "Inertia calculation for fixed joints incorrect", "component": null, "votes": 0, "watches": 4, "content": {"raw": "This bug report assumes that the moment of inertia specified in a URDF is with respect to the coordinate frame of the <inertia> tag (at the center of mass).\r\n\r\nThere is a bug in the URDF parser that reduces fixed joints (\"parser_urdf.cc\", [URDF2Gazebo::ReduceFixedJoints](https://bitbucket.org/osrf/gazebo/src/9a4c0147feb9538375e2dd5bec39e0b353f05556/gazebo/sdf/interface/parser_urdf.cc#cl-898).  In particular, it calls the method [URDF2Gazebo::ReduceInertialToParent](https://bitbucket.org/osrf/gazebo/src/9a4c0147feb9538375e2dd5bec39e0b353f05556/gazebo/sdf/interface/parser_urdf.cc#cl-1825).\r\n\r\nThis method appears to assume that the moments of inertia are written with respect to their *link origins* and not the center of mass.  The inertia of the child link is translated using the origin transform of the fixed joint, only.\r\n\r\nThe correct method is to:\r\n1) First calculate the new center of mass position\r\n2) Transform both parent and child inertias to that new CM\r\n3) Then sum the two inertias.\r\n\r\nAnother, more roundabout approach (that makes use of the current code) is to:\r\n1) Transform both parent and child inertias to the parent link origin.\r\n2) Sum the two inertias using dMassAdd\r\n3) Transform the summed inertia to the new CM\r\n\r\nNote, for the DRC, this primarily effects the Sandia hand URDF.  The base Atlas does not have any links with significant mass attached via fixed joints.  On each Sandia hand, the hand, palm, and 4x finger base links are all joined by fixed joints.\r\n\r\nThe resulting inertia in Gazebo is significantly larger than the true inertia (by a factor of 2-3) which noticeably impacts the simulation of the robot. ", "markup": "markdown", "html": "<p>This bug report assumes that the moment of inertia specified in a URDF is with respect to the coordinate frame of the &lt;inertia&gt; tag (at the center of mass).</p>\n<p>There is a bug in the URDF parser that reduces fixed joints (\"parser_urdf.cc\", <a data-is-external-link=\"true\" href=\"https://bitbucket.org/osrf/gazebo/src/9a4c0147feb9538375e2dd5bec39e0b353f05556/gazebo/sdf/interface/parser_urdf.cc#cl-898\" rel=\"nofollow\">URDF2Gazebo::ReduceFixedJoints</a>.  In particular, it calls the method <a data-is-external-link=\"true\" href=\"https://bitbucket.org/osrf/gazebo/src/9a4c0147feb9538375e2dd5bec39e0b353f05556/gazebo/sdf/interface/parser_urdf.cc#cl-1825\" rel=\"nofollow\">URDF2Gazebo::ReduceInertialToParent</a>.</p>\n<p>This method appears to assume that the moments of inertia are written with respect to their <em>link origins</em> and not the center of mass.  The inertia of the child link is translated using the origin transform of the fixed joint, only.</p>\n<p>The correct method is to:\n1) First calculate the new center of mass position\n2) Transform both parent and child inertias to that new CM\n3) Then sum the two inertias.</p>\n<p>Another, more roundabout approach (that makes use of the current code) is to:\n1) Transform both parent and child inertias to the parent link origin.\n2) Sum the two inertias using dMassAdd\n3) Transform the summed inertia to the new CM</p>\n<p>Note, for the DRC, this primarily effects the Sandia hand URDF.  The base Atlas does not have any links with significant mass attached via fixed joints.  On each Sandia hand, the hand, palm, and 4x finger base links are all joined by fixed joints.</p>\n<p>The resulting inertia in Gazebo is significantly larger than the true inertia (by a factor of 2-3) which noticeably impacts the simulation of the robot. </p>", "type": "rendered"}, "assignee": {"display_name": "John Hsu", "uuid": "{0a186eae-abf0-4514-a951-23db5eccc286}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D"}, "html": {"href": "https://bitbucket.org/%7B0a186eae-abf0-4514-a951-23db5eccc286%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:f3968cd3-4910-4384-8349-482a6c7889ec/5445ce6e-6273-47f0-84eb-621c86ca11cb/128"}}, "nickname": "hsu", "type": "user", "account_id": "557058:f3968cd3-4910-4384-8349-482a6c7889ec"}, "state": "resolved", "version": null, "edited_on": null, "created_on": "2013-05-28T20:07:35.459325+00:00", "milestone": null, "updated_on": "2013-05-31T00:34:19.387262+00:00", "type": "issue", "id": 308}