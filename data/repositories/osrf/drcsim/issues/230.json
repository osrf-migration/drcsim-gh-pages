{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/drcsim.json"}, "html": {"href": "#!/osrf/drcsim"}, "avatar": {"href": "data/bytebucket.org/ravatar/{247b5408-ae91-4e3c-b2f9-a21994658d11}ts=c_plus_plus"}}, "type": "repository", "name": "drcsim", "full_name": "osrf/drcsim", "uuid": "{247b5408-ae91-4e3c-b2f9-a21994658d11}"}, "links": {"attachments": {"href": "data/repositories/osrf/drcsim/issues/230/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/drcsim/issues/230.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/drcsim/issues/230/watch"}, "comments": {"href": "data/repositories/osrf/drcsim/issues/230/comments_page=1.json"}, "html": {"href": "#!/osrf/drcsim/issues/230/crash-in-atlassiminterface-from-sending"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/drcsim/issues/230/vote"}}, "reporter": {"display_name": "andy_somerville", "uuid": "{09fd5d4b-d90e-4416-9a6a-2e5cd638472c}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B09fd5d4b-d90e-4416-9a6a-2e5cd638472c%7D"}, "html": {"href": "https://bitbucket.org/%7B09fd5d4b-d90e-4416-9a6a-2e5cd638472c%7D/"}, "avatar": {"href": "https://bitbucket.org/account/andy_somerville/avatar/"}}, "nickname": "andy_somerville", "type": "user", "account_id": null}, "title": "Crash in AtlasSimInterface from sending walk messages too quickly.", "component": null, "votes": 0, "watches": 3, "content": {"raw": "Not sure if there is a separate bug reporting mechanism for libAtlasSimInterface.so, but I'm adding it here for lack of a better option.\r\n\r\nCrash is apparently because I errantly sent 4 walk messages in quick succession. \r\n\r\nUpon sending a walk command to /atlas/atlas_sim_interface_command Gazebo exits with no error message. Crash is repeatable.\r\n\r\n\r\n\r\n```\r\n#!terminal\r\n\r\n[gazebo-2] process has finished cleanly\r\nlog file: <redacted>/.ros/log/d94c4eee-b1e3-11e2-8761-0025648c7b5e/gazebo-2*.log\r\n```\r\n\r\nUsing gdb with --pid attaching to gzserver and catching syscall 60 and breaking at _exit I was able to observe a segfault at the moment of the crash.\r\n\r\n\r\n```\r\n#!gdb\r\n\r\n#0  0x00007fc48197083c in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\r\n#1  0x00007fc481988613 in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\r\n#2  0x00007fc481988695 in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\r\n#3  0x00007fc481962a6c in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\r\n#4  0x00007fc481c8fc53 in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\r\n#5  0x00007fc481923096 in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\r\n#6  0x00007fc48189956f in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\r\n#7  0x00007fc4818978fd in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\r\n#8  0x00007fc48189a709 in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\r\n#9  0x00007fc481895a50 in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\r\n#10 0x00007fc48236e00b in gazebo::AtlasPlugin::UpdateStates() () from /usr/lib/drcsim-2.5/plugins/libAtlasPlugin.so\r\n#11 0x00007fc52610d2ee in gazebo::physics::World::Update() () from /usr/lib/libgazebo_physics.so.1\r\n#12 0x00007fc5261150a8 in gazebo::physics::World::Step() () from /usr/lib/libgazebo_physics.so.1\r\n#13 0x00007fc526117a54 in gazebo::physics::World::RunLoop() () from /usr/lib/libgazebo_physics.so.1\r\n#14 0x00007fc524cface9 in thread_proxy () from /usr/lib/libboost_thread.so.1.46.1\r\n#15 0x00007fc525862e9a in start_thread (arg=0x7fc47bfff700) at pthread_create.c:308\r\n#16 0x00007fc5240a3ccd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:112\r\n#17 0x0000000000000000 in ?? ()\r\n\r\n```\r\n\r\nImmediately after being sent 4 messages in rapid succession that looked like this except that the step_index for respective messages would have started at 0 and be sent in groups of 4:\r\n\r\n\r\n```\r\n#!json\r\n\r\nheader: \r\n  seq: 3\r\n  stamp: \r\n    secs: 0\r\n    nsecs: 0\r\n  frame_id: ''\r\nbehavior: 4\r\nwalk_params: \r\n  step_data: \r\n    - \r\n      step_index: 12\r\n      foot_index: 0\r\n      duration: 0.63\r\n      pose: \r\n        position: \r\n          x: 2.56717912253\r\n          y: 0.141389053762\r\n          z: 8.75890254974e-05\r\n        orientation: \r\n          x: 0.00124522134858\r\n          y: -0.00326941626078\r\n          z: -0.0147462411844\r\n          w: 0.999885147761\r\n      swing_height: 0.05\r\n    - \r\n      step_index: 13\r\n      foot_index: 1\r\n      duration: 0.63\r\n      pose: \r\n        position: \r\n          x: 2.78717912253\r\n          y: -0.148610946238\r\n          z: 8.75890254974e-05\r\n        orientation: \r\n          x: 0.00124522134858\r\n          y: -0.00326941626078\r\n          z: -0.0147462411844\r\n          w: 0.999885147761\r\n      swing_height: 0.05\r\n    - \r\n      step_index: 14\r\n      foot_index: 0\r\n      duration: 0.63\r\n      pose: \r\n        position: \r\n          x: 3.00717912253\r\n          y: 0.141389053762\r\n          z: 8.75890254974e-05\r\n        orientation: \r\n          x: 0.00124522134858\r\n          y: -0.00326941626078\r\n          z: -0.0147462411844\r\n          w: 0.999885147761\r\n      swing_height: 0.05\r\n    - \r\n      step_index: 15\r\n      foot_index: 1\r\n      duration: 0.63\r\n      pose: \r\n        position: \r\n          x: 3.00217912253\r\n          y: -0.148610946238\r\n          z: 8.75890254974e-05\r\n        orientation: \r\n          x: 0.00124522134858\r\n          y: -0.00326941626078\r\n          z: -0.0147462411844\r\n          w: 0.999885147761\r\n      swing_height: 0.05\r\n  use_demo_walk: False\r\nstep_params: \r\n  desired_step: \r\n    step_index: 0\r\n    foot_index: 0\r\n    duration: 0.0\r\n    pose: \r\n      position: \r\n        x: 0.0\r\n        y: 0.0\r\n        z: 0.0\r\n      orientation: \r\n        x: 0.0\r\n        y: 0.0\r\n        z: 0.0\r\n        w: 0.0\r\n    swing_height: 0.0\r\n  use_demo_walk: False\r\nstand_params: \r\n  use_desired_pelvis_height: False\r\n  desired_pelvis_height: 0.0\r\n  desired_pelvis_yaw: 0.0\r\n  desired_pelvis_lat: 0.0\r\nmanipulate_params: \r\n  use_desired: False\r\n  desired: \r\n    pelvis_height: 0.0\r\n    pelvis_yaw: 0.0\r\n    pelvis_lat: 0.0\r\n  use_demo_mode: False\r\nk_effort: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\r\n---\r\n```\r\n\r\nVersions:\r\ngazebo: 1.7.1-1~precise\r\ndrcsim: 2.5.2-1~precise\r\n\r\nI have a core, but it's 3.8GB...", "markup": "markdown", "html": "<p>Not sure if there is a separate bug reporting mechanism for libAtlasSimInterface.so, but I'm adding it here for lack of a better option.</p>\n<p>Crash is apparently because I errantly sent 4 walk messages in quick succession. </p>\n<p>Upon sending a walk command to /atlas/atlas_sim_interface_command Gazebo exits with no error message. Crash is repeatable.</p>\n<div class=\"codehilite language-terminal\"><pre><span></span>[gazebo-2] process has finished cleanly\nlog file: &lt;redacted&gt;/.ros/log/d94c4eee-b1e3-11e2-8761-0025648c7b5e/gazebo-2*.log\n</pre></div>\n\n\n<p>Using gdb with --pid attaching to gzserver and catching syscall 60 and breaking at _exit I was able to observe a segfault at the moment of the crash.</p>\n<div class=\"codehilite language-gdb\"><pre><span></span>#0  0x00007fc48197083c in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\n#1  0x00007fc481988613 in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\n#2  0x00007fc481988695 in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\n#3  0x00007fc481962a6c in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\n#4  0x00007fc481c8fc53 in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\n#5  0x00007fc481923096 in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\n#6  0x00007fc48189956f in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\n#7  0x00007fc4818978fd in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\n#8  0x00007fc48189a709 in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\n#9  0x00007fc481895a50 in ?? () from /usr/lib/drcsim-2.5/AtlasSimInterface_1.0.8/libAtlasSimInterface.so\n#10 0x00007fc48236e00b in gazebo::AtlasPlugin::UpdateStates() () from /usr/lib/drcsim-2.5/plugins/libAtlasPlugin.so\n#11 0x00007fc52610d2ee in gazebo::physics::World::Update() () from /usr/lib/libgazebo_physics.so.1\n#12 0x00007fc5261150a8 in gazebo::physics::World::Step() () from /usr/lib/libgazebo_physics.so.1\n#13 0x00007fc526117a54 in gazebo::physics::World::RunLoop() () from /usr/lib/libgazebo_physics.so.1\n#14 0x00007fc524cface9 in thread_proxy () from /usr/lib/libboost_thread.so.1.46.1\n#15 0x00007fc525862e9a in start_thread (arg=0x7fc47bfff700) at pthread_create.c:308\n#16 0x00007fc5240a3ccd in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:112\n#17 0x0000000000000000 in ?? ()\n</pre></div>\n\n\n<p>Immediately after being sent 4 messages in rapid succession that looked like this except that the step_index for respective messages would have started at 0 and be sent in groups of 4:</p>\n<div class=\"codehilite language-json\"><pre><span></span><span class=\"err\">header:</span> \n  <span class=\"err\">seq:</span> <span class=\"mi\">3</span>\n  <span class=\"err\">stamp:</span> \n    <span class=\"err\">secs:</span> <span class=\"mi\">0</span>\n    <span class=\"err\">nsecs:</span> <span class=\"mi\">0</span>\n  <span class=\"err\">frame_id:</span> <span class=\"err\">&#39;&#39;</span>\n<span class=\"err\">behavior:</span> <span class=\"mi\">4</span>\n<span class=\"err\">walk_params:</span> \n  <span class=\"err\">step_data:</span> \n    <span class=\"err\">-</span> \n      <span class=\"err\">step_index:</span> <span class=\"mi\">12</span>\n      <span class=\"err\">foot_index:</span> <span class=\"mi\">0</span>\n      <span class=\"err\">duration:</span> <span class=\"mf\">0.63</span>\n      <span class=\"err\">pose:</span> \n        <span class=\"err\">position:</span> \n          <span class=\"err\">x:</span> <span class=\"mf\">2.56717912253</span>\n          <span class=\"err\">y:</span> <span class=\"mf\">0.141389053762</span>\n          <span class=\"err\">z:</span> <span class=\"mf\">8.75890254974e-05</span>\n        <span class=\"err\">orientation:</span> \n          <span class=\"err\">x:</span> <span class=\"mf\">0.00124522134858</span>\n          <span class=\"err\">y:</span> <span class=\"mf\">-0.00326941626078</span>\n          <span class=\"err\">z:</span> <span class=\"mf\">-0.0147462411844</span>\n          <span class=\"err\">w:</span> <span class=\"mf\">0.999885147761</span>\n      <span class=\"err\">swing_height:</span> <span class=\"mf\">0.05</span>\n    <span class=\"err\">-</span> \n      <span class=\"err\">step_index:</span> <span class=\"mi\">13</span>\n      <span class=\"err\">foot_index:</span> <span class=\"mi\">1</span>\n      <span class=\"err\">duration:</span> <span class=\"mf\">0.63</span>\n      <span class=\"err\">pose:</span> \n        <span class=\"err\">position:</span> \n          <span class=\"err\">x:</span> <span class=\"mf\">2.78717912253</span>\n          <span class=\"err\">y:</span> <span class=\"mf\">-0.148610946238</span>\n          <span class=\"err\">z:</span> <span class=\"mf\">8.75890254974e-05</span>\n        <span class=\"err\">orientation:</span> \n          <span class=\"err\">x:</span> <span class=\"mf\">0.00124522134858</span>\n          <span class=\"err\">y:</span> <span class=\"mf\">-0.00326941626078</span>\n          <span class=\"err\">z:</span> <span class=\"mf\">-0.0147462411844</span>\n          <span class=\"err\">w:</span> <span class=\"mf\">0.999885147761</span>\n      <span class=\"err\">swing_height:</span> <span class=\"mf\">0.05</span>\n    <span class=\"err\">-</span> \n      <span class=\"err\">step_index:</span> <span class=\"mi\">14</span>\n      <span class=\"err\">foot_index:</span> <span class=\"mi\">0</span>\n      <span class=\"err\">duration:</span> <span class=\"mf\">0.63</span>\n      <span class=\"err\">pose:</span> \n        <span class=\"err\">position:</span> \n          <span class=\"err\">x:</span> <span class=\"mf\">3.00717912253</span>\n          <span class=\"err\">y:</span> <span class=\"mf\">0.141389053762</span>\n          <span class=\"err\">z:</span> <span class=\"mf\">8.75890254974e-05</span>\n        <span class=\"err\">orientation:</span> \n          <span class=\"err\">x:</span> <span class=\"mf\">0.00124522134858</span>\n          <span class=\"err\">y:</span> <span class=\"mf\">-0.00326941626078</span>\n          <span class=\"err\">z:</span> <span class=\"mf\">-0.0147462411844</span>\n          <span class=\"err\">w:</span> <span class=\"mf\">0.999885147761</span>\n      <span class=\"err\">swing_height:</span> <span class=\"mf\">0.05</span>\n    <span class=\"err\">-</span> \n      <span class=\"err\">step_index:</span> <span class=\"mi\">15</span>\n      <span class=\"err\">foot_index:</span> <span class=\"mi\">1</span>\n      <span class=\"err\">duration:</span> <span class=\"mf\">0.63</span>\n      <span class=\"err\">pose:</span> \n        <span class=\"err\">position:</span> \n          <span class=\"err\">x:</span> <span class=\"mf\">3.00217912253</span>\n          <span class=\"err\">y:</span> <span class=\"mf\">-0.148610946238</span>\n          <span class=\"err\">z:</span> <span class=\"mf\">8.75890254974e-05</span>\n        <span class=\"err\">orientation:</span> \n          <span class=\"err\">x:</span> <span class=\"mf\">0.00124522134858</span>\n          <span class=\"err\">y:</span> <span class=\"mf\">-0.00326941626078</span>\n          <span class=\"err\">z:</span> <span class=\"mf\">-0.0147462411844</span>\n          <span class=\"err\">w:</span> <span class=\"mf\">0.999885147761</span>\n      <span class=\"err\">swing_height:</span> <span class=\"mf\">0.05</span>\n  <span class=\"err\">use_demo_walk:</span> <span class=\"err\">False</span>\n<span class=\"err\">step_params:</span> \n  <span class=\"err\">desired_step:</span> \n    <span class=\"err\">step_index:</span> <span class=\"mi\">0</span>\n    <span class=\"err\">foot_index:</span> <span class=\"mi\">0</span>\n    <span class=\"err\">duration:</span> <span class=\"mf\">0.0</span>\n    <span class=\"err\">pose:</span> \n      <span class=\"err\">position:</span> \n        <span class=\"err\">x:</span> <span class=\"mf\">0.0</span>\n        <span class=\"err\">y:</span> <span class=\"mf\">0.0</span>\n        <span class=\"err\">z:</span> <span class=\"mf\">0.0</span>\n      <span class=\"err\">orientation:</span> \n        <span class=\"err\">x:</span> <span class=\"mf\">0.0</span>\n        <span class=\"err\">y:</span> <span class=\"mf\">0.0</span>\n        <span class=\"err\">z:</span> <span class=\"mf\">0.0</span>\n        <span class=\"err\">w:</span> <span class=\"mf\">0.0</span>\n    <span class=\"err\">swing_height:</span> <span class=\"mf\">0.0</span>\n  <span class=\"err\">use_demo_walk:</span> <span class=\"err\">False</span>\n<span class=\"err\">stand_params:</span> \n  <span class=\"err\">use_desired_pelvis_height:</span> <span class=\"err\">False</span>\n  <span class=\"err\">desired_pelvis_height:</span> <span class=\"mf\">0.0</span>\n  <span class=\"err\">desired_pelvis_yaw:</span> <span class=\"mf\">0.0</span>\n  <span class=\"err\">desired_pelvis_lat:</span> <span class=\"mf\">0.0</span>\n<span class=\"err\">manipulate_params:</span> \n  <span class=\"err\">use_desired:</span> <span class=\"err\">False</span>\n  <span class=\"err\">desired:</span> \n    <span class=\"err\">pelvis_height:</span> <span class=\"mf\">0.0</span>\n    <span class=\"err\">pelvis_yaw:</span> <span class=\"mf\">0.0</span>\n    <span class=\"err\">pelvis_lat:</span> <span class=\"mf\">0.0</span>\n  <span class=\"err\">use_demo_mode:</span> <span class=\"err\">False</span>\n<span class=\"err\">k_effort:</span> <span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">]</span>\n<span class=\"err\">---</span>\n</pre></div>\n\n\n<p>Versions:\ngazebo: 1.7.1-1~precise\ndrcsim: 2.5.2-1~precise</p>\n<p>I have a core, but it's 3.8GB...</p>", "type": "rendered"}, "assignee": null, "state": "resolved", "version": null, "edited_on": null, "created_on": "2013-04-30T22:51:32.530960+00:00", "milestone": null, "updated_on": "2013-05-07T16:40:29.848892+00:00", "type": "issue", "id": 230}